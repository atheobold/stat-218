---
title: "Week 5 Day 4: Weather Patterns and Record Snowfall"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      message = FALSE, 
                      warning = FALSE, 
                      fig.align = "center", 
                      out.width = "60%")

library(tidyverse)
library(mosaic)
```


### Learning outcomes

* Given a research question involving one categorical explanatory variable and
one quantitative response variable, construct the null and alternative
hypotheses in words and using appropriate statistical symbols.

* Describe and perform a simulation-based hypothesis test for a difference in
means.

* Interpret and evaluate a p-value for a simulation-based hypothesis test for a difference in means.

### Terminology review

In today's activity, we will use simulation-based methods to analyze the
association between one categorical explanatory variable and one quantitative
response variable, where the groups formed by the categorical variable are
independent. Some terms covered in this activity are:

* Independent groups

* Difference in means

---

### Weather patterns and record snowfall

In the winter of 2018--2019, Bozeman, Montana had a record snowfall which
resulted in the collapse of two flat-roofed buildings on the MSU campus.  A
writer for the *Washington Post* predicted the heavy snowfall for 2018--2019 due
to the El Ni\latexcode{\~{n}}o weather pattern that occurred in that season. A
meteorologist in Montana wanted to see if the weather pattern really was
associated with total snowfall. She obtained historical data from 44 years on
the weather pattern (El Ni\latexcode{\~{n}}o or La Ni\latexcode{\~{n}}a) and
snowfall (in inches) at the Billings Weather Station.  Faceted histograms and
summary statistics for each group are shown on the following page.

```{r data, includ = FALSE}
snow <- read_csv(here::here("Week 5 - Difference in Means & Midterm 1", 
                            "activity", 
                            "day 2", 
                            "data", 
                            "SnowfallByWeatherPattern.csv")
                 )
```

```{r data-preview}
glimpse(snow)
```

\newpage

## Exploratory Data Analysis 

```{r facet-hist}
ggplot(data = snow, 
       mapping = aes(x = WeatherPattern)) +
  geom_histogram() + 
  labs(x = "Weather pattern") +
  facet_wrap(~Snowfall)
```

```{r summary-stats}
favstats(Snowfall ~ WeatherPattern, data - snow)
```

1. The two variables assessed in this study are the type of weather pattern and snowfall.  Identify the role for each variable (explanatory or response).

\vspace{.4in}

2. Which group (El Ni\latexcode{\~{n}}o or La Ni\latexcode{\~{n}}a) has the
highest center in the distributions of snowfall? Explain which measure of center
you are using! 

\vspace{.4in}

3.  Using the faceted histograms, which group has the largest spread in
snowfall?  How did you make that choice?

\vspace{.4in}

4.  Is this an experiment or an observational study? Justify your answer.

\vspace{1in}

5. Are the observations in the dataset independent? Explain your reasoning.

\newpage 

#### Use statistical inferential methods to draw inferences from the data {-}

#### Ask a research question

6.  Write out the parameter of interest in context of the study.  Use proper
notation and be sure to define your subscripts.  Use El Ni\latexcode{\~{n}}o
minus La Ni\latexcode{\~{n}}a as the order of subtraction.

\vspace{1in}

7.  Write out the null hypothesis in words.

\vspace{1in}

8.  Write the alternative hypothesis in notation. 

\vspace{0.5in}

9. Calculate the observed statistic of interest (difference in means).  Use El Ni\latexcode{\~{n}}o minus La Ni\latexcode{\~{n}}a as the order of subtraction.
What is the appropriate notation for this statistic?


##### Hypothesis test {-}

Remember that the null distribution is created based on the assumption the null hypothesis is true.  In this study, the null hypothesis states that there is no association between the two variables.  This means that the snowfall values
observed in the data set would have been the same regardless of the weather
pattern that year.

I've provided your group with a set of cards to use to simulate a sample that 
could have happened if the null was true. 

10.  How many cards will we start with?

\vspace{0.3in}

11.  What will we write on each card?

\vspace{0.3in}

12.  Next, we will mix the cards together and shuffle into two piles. How many
cards will go into each pile?  What should we label the piles?

\vspace{.8in}

13.  What value is calculated from the cards and plotted on the null 
distribution?  *Hint*: What statistic are we calculating from the data?

\vspace{0.3in}

14.  Create one simulation using the cards provided.  Is your simulated
statistic closer to the null value of zero than the difference in means
calculated from the sample?  Explain why this makes sense.

\vspace{0.8in}

15.  Once we create a null distribution of 1000 simulations, at what value do
you expect the distribution to be centered?  Explain your reasoning.

\vspace{.8in}

---

## Carrying out the simulation in `R`


We will use the `two_mean_test()` function in `R` (in the `catstats` package) to simulate the null distribution of differences in sample means and compute a p-value. 

16.  When using the `two_mean_test()` function, we need to enter the name of the response variable, `Snowfall`, and the name of the explanatory variable, `WeatherPattern`, for the formula.  The name of the data set as shown above is `Snow`.  What values should be entered for each of the following to create 1000 simulated samples?

* First in subtraction (What is the outcome for the explanatory variable that is used as first in the order of subtraction? `"El_Nino"` or `"La_Nina"`):

\vspace{.2in}
* Number of repetitions:
    
\vspace{.2in}
* As extreme as:
    
\vspace{.2in}
* Direction (`"greater"`, `"less"`, or `"two-sided"`):

\vspace{.2in}

17.  Simulate a null distribution and compute the p-value. Using the `R` script file for this activity, enter your answers for question 16 in place of the `xx`'s to produce the null distribution with 1000 simulations.  Highlight and run lines 1--29.

```{r, echo = TRUE, eval = FALSE}
two_mean_test(Snowfall ~ WeatherPattern, data = Snow,  # Variables and data
         first_in_subtraction = "xx", # First outcome in order of subtraction
         number_repetitions = 1000,  # Number of simulations
         as_extreme_as = xx,  # Observed statistic
         direction = "xx")  # Direction of alternative: "greater", "less", or "two-sided"
```

18.  Report the p-value. Based off of this p-value, write a conclusion to the
hypothesis test.


---

## Using theoretical methods instead...


---

### Take-home messages

1. To create one simulated sample on the null distribution for a difference in
sample means, label cards with the response variable values from the original
data.  Mix cards together and shuffle into two new groups of sizes $n_1$ and
$n_2$. Calculate and plot the difference in means. 

<!-- 2. Something about theoretical methods -->

